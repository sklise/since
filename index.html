<!DOCTYPE html>
<html>
<head>
  <title>Days Since!</title>
  <meta name="application-name" content="currency.io">
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <link rel="stylesheet" href="css/main.css" type="text/css" />
</head>
<body>
  <div id="list">
  </div>

  <div class="item-wrapper">
    <div class="item-front">
      <div class="item-counter">4</div>
      <div class="item-title">Jade</div>
    </div>
    <div class="item-back">
      <p>Started on May 28</p>
      <p>4 days, 3 hours</p>
    </div>
  </div>

  <div class="item-wrapper">
    <div class="item-front">
      <div class="item-counter">4</div>
      <div class="item-title">Jade</div>
    </div>
    <div class="item-back">
      <p>Started on May 28</p>
      <p>4 days, 3 hours</p>
    </div>
  </div>

  <div class="item-wrapper">
    <div class="item-front">
      <div class="item-counter">4</div>
      <div class="item-title">Jade</div>
    </div>
    <div class="item-back">
      <p>Started on May 28</p>
      <p>4 days, 3 hours</p>
    </div>
  </div>

  <div class="item-wrapper">
    <div class="item-front">
      <div class="item-counter">4</div>
      <div class="item-title">Jade</div>
    </div>
    <div class="item-back">
      <p>Started on May 28</p>
      <p>4 days, 3 hours</p>
    </div>
  </div>

  <script type="text/template" id="item-template">
    <div class="item-front">
      <div class="item-counter">{{ count }}</div>
      <div class="item-title">{{ title }}</div>
    </div>
    <div class="item-back">
      <p>Started on May 28</p>
      <p>4 days, 3 hours</p>
    </div>
  </script>

  <script src="js/fastclick.js" type="text/javascript"></script>
  <script src="js/jquery2.js" type="text/javascript"></script>
  <script src="js/underscore.js" type="text/javascript"></script>
  <script src="js/backbone.js" type="text/javascript"></script>
  <script src="js/handlebars.js" type="text/javascript"></script>
  <script src="js/hammer.js" type="text/javascript"></script>

  <script>
  $(function() {
    var Item = Backbone.Model.extend();

    var Items = Backbone.Collection.extend({
      model: Item
    });

    var ItemView = Backbone.View.extend({
      className: 'item-wrapper',

      initialize: function () {},

      render: function () {
        var view = this;
        var template = Handlebars.compile($('#item-template').html());

        $('#list').append(this.$el.html(template(this.model.toJSON())));


        this.$el.hammer().on("dragleft", view.restartCount);
        this.$el.hammer().on("dragend", view.dragEnd);
        this.$el.hammer().on("release", view.release);

        return this;
      },

      restartCount: function (event) {
        event.gesture.preventDefault();

        var front = $(this).find('.item-front');
        var item_width = front.width();
        var threshold = item_width / 3;

        front.css('left', event.gesture.deltaX+'px');

        if (event.gesture.deltaX * -1 > threshold) {
          front.addClass('reset');
        }
      },

      dragEnd: function(event) {
        var front = $(this).find('.item-front');

        if (front.hasClass('reset')) {
          front.find('.item-counter').html('0');
        }

        $(this).find('.item-front').css('left','auto');
      },

      release: function (event) {
        $(this).find('.item-front').removeClass('reset');
      }
    });

    window.since = {
      Item: Item,
      Items: Items,
      ItemView: ItemView
    };

    FastClick.attach(document.body);

    $('.item-wrapper').hammer().on("doubletap", function (event) {
      event.gesture.preventDefault();
      $(this).toggleClass('show-back');
      $(this).siblings().removeClass('show-back');
    });
  });
  </script>
</body>
</html>